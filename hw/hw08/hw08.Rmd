---
author: "YOUR NAME HERE"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE,
                      warning = FALSE, error = TRUE, fig.height = 3)
library(tidyverse)
library(kableExtra)
source("../../scripts/viridis.R")
source("../../scripts/ggprob.R")
```

\newcommand{\E}{\mathsf{E}}
\newcommand{\Var}{\mathsf{Var}}
\renewcommand{\prob}{\mathsf{P}}


## Assignment 8

#### Due Friday, November 3, 11:59 PM CT

### Preliminaries

- Directories
    - COURSE/homework/
    - COURSE/homework/hw08/
    - COURSE/data/
    - COURSE/scripts/
- Files
  - COURSE/homework/hw08/hw08.Rmd
  - COURSE/scripts/viridis.R
  - COURSE/scripts/ggprob.R

### Aims

- Practice the binomial distribution

### Problems

  1. What is the probability that a sequence of fair, independent coin tosses results in exactly $m$ heads in $n = 2m$ independent coin tosses, when $m$ varies from 1 to 50? Calculate these values using `dbinom()` and plot them versus $n$.
  
```{r}
# P(X = m) = dbinom(m, 2m, 0.5)

m <- 1:50
n <- 2*m
prob <- dbinom(m, n, 0.5)

data <- tibble(m = m, n = n, prob = prob)

plot <- ggplot(data, aes(x = n, y = prob)) +
  geom_point() +
  geom_line() +
  xlab("Number of Tosses (n)") +
  ylab("Probability") +
  ggtitle("Probability of m heads in 2m tosses") +
  theme_minimal()

print(plot)
```
  


  2. Suppose you have a random variable $X \sim \text{Binomial}(120, 0.2)$.

- 2a. Calculate and report the mean and standard deviation of the distribution.

```{r}
mean <- 120*0.2 # 24
sd <- sqrt(120*0.2*0.8) # 4.38178

# X ~ Binomial(120, 0.2):
#   mean = 24
#   sd = 4.38178

print("X ~ Binomial(120, 0.2):")
print(paste("  mean =", mean))
print(paste("  sd =", sd))
```

- 2b. Calculate and report the probability that the random variable is exactly equal to 20, $\prob(X = 20)$.

```{r}
# P(X = 20) = dbinom(20, 120, 0.2)

res <- dbinom(20, 120, 0.2)
print(paste("prob =", res))
```

- 2c. Calculate and report the probability that $X$ equals 20 or more, $\prob(X \ge 20)$.

```{r}
res <- pbinom(20, 120, 0.2, lower.tail = FALSE)
print(paste("prob =", res))

```

- 2d. Draw a graph of the binomial distribution with vertical lines at the mean (red and dashed), and 1, 2, and 3 standard deviations above and below the mean (red and dotted).


```{r}

n <- 120
p <- 0.2
mean <- n*p
sd <- sqrt(n*p*(1-p))

df <- tibble(x = seq(0, n, 1),
             prob = dbinom(x, n, p))

plot <- ggplot(df, aes(x = x, y = prob)) +
  geom_col(fill = "lightblue", width=0.7) +
  geom_vline(xintercept = mean, color = "red", linetype = "dashed") +
  geom_vline(xintercept = mean + sd, color = "red", linetype = "dotted") +
  geom_vline(xintercept = mean - sd, color = "red", linetype = "dotted") +
  geom_vline(xintercept = mean + 2*sd, color = "red", linetype = "dotted") +
  geom_vline(xintercept = mean - 2*sd, color = "red", linetype = "dotted") +
  geom_vline(xintercept = mean + 3*sd, color = "red", linetype = "dotted") +
  geom_vline(xintercept = mean - 3*sd, color = "red", linetype = "dotted") +
  xlab("x") +
  ylab("Probability") +
  ggtitle("Binomial(120, 0.2) distribution") +
  theme_minimal()

print(plot)
```





  3. What is the probability that $X$ from Problem 2 is within one, two, and three standard deviations of the mean? Round each probability to four decimal places.

```{r}
# 1 sd
res_1sd <- round(pbinom(mean + sd, n, p) - pbinom(mean - sd, n, p), 4)

# 2 sd
res_2sd <- round(pbinom(mean + 2*sd, n, p) - pbinom(mean - 2*sd, n, p), 4)

# 3 sd
res_3sd <- round(pbinom(mean + 3*sd, n, p) - pbinom(mean - 3*sd, n, p), 4)

print (paste("1 sd =", res_1sd)) # 68
print (paste("2 sd =", res_2sd)) # 95
print (paste("3 sd =", res_3sd)) # 99.7 - checks out

```






  4. The following code makes a graph of the cumulative distribution function for the $\text{Binomial}(7, 0.3)$ distribution, that is $F(x) = \prob(X \le x)$. This is the function which is calculated by the base R function `pbinom()`.

- Modify the code to add a horizontal red dotted line at 0.4.


```{r}
prob4 = tibble(
  x = seq(-1,8,1),
  p = dbinom(x, 7, 0.3),
  cdf = pbinom(x, 7, 0.3))

ggplot(prob4, aes(x = x, y = cdf )) +
  geom_step(color = "blue") +
  geom_hline(yintercept = 0) +
  geom_hline(yintercept = 0.4, color = "red", linetype = "dotted") +
  scale_x_continuous(breaks = 0:7) +
  xlab("x") +
  ylab("Probability") +
  ggtitle("Binomial(7, 0.3) distribution CDF") +
  theme_minimal()
```

- Calculate the 0.4 quantile of the $\text{Binomial}(7, 0.3)$

```{r}
# calculate 0.4 quantile of Binomial(7, 0.3)
qbinom(0.4, 7, 0.3)
```

- Explain how the value of the quantile is related to the red dotted line which you added to the plot.

> [Write your answer here]

- Use the graph to determine the 0.75 quantile of this distribution.
Then verify your observation with a calculation.

```{r}
# determine 0.75 quantile of Binomial(7, 0.3)
qbinom(0.75, 7, 0.3)

# verify with calculation
prob4 %>% filter(cdf >= 0.75) %>% slice(1)

# since x = 3, the 0.75 quantile is 3
```





  5. In a large population of likely voters, the proportion of voters who plan to vote for candidate A is $p = 0.52$. In a random sample of 600 likely voters, what is the probability that the proportion of voters who plan to vote for candidate A is less than 50% (the number of such voters is less than 300)?
  
```{r}
# params
n <- 600
p <- 0.52
mu <- n * p
sd <- sqrt(n * p * (1 - p))

z <- (300 - mu) / sd

# probability
prob <- round(pnorm(z), 4)

print(paste("Probability =", prob))
```




  6. Basketball player 1 makes 80% of their free throws and basketball players 2 makes 70% of their free throws. Assume all of their free throws attempts are independent. If each player takes ten free throws and $X$ is the total number of free throws they make, does $X$ have a binomial distribution? If yes, specify the parameters $n$ and $p$. If not, explain why not.
  
No, $X$ does not have a binomial distribution because the probability of success is not the same for each trial. The probability of success for player 1 is 0.8 and the probability of success for player 2 is 0.7. Therefore, $X$ does not have a binomial distribution.




  7. What is the smallest number of coin tosses $n$ of a fair coin so that the chance of getting 50 or more heads exceeds 90%?  (You may need to do some trial and error. Alternatively, think of creating a data frame with a column `n` and a column for the probability and using this to find the answer.)

```{r}
n <- 50
df = tibble(n = 50:1000)

prob_49_or_less <- function(n) {
  pbinom(49, n, 0.5)
}

df <- df %>% 
  mutate(prob = round(1 - prob_49_or_less(n), 4)) # alternatively, could use a while loop

df %>% filter(prob >= 0.9) %>% slice(1)

```

113 tosses




  8. The random variable $X$ has the $\text{Binomial}(100, 0.2)$ distribution.
  
- Find an integer $a$ so that $P(X \le a) \ge 0.5$ and $P(X \ge a) \ge 0.5$.
- Show the values of $a$, $P(X \le a)$, and $P(X \ge a)$.

```{r}
#find a s.t. P(X <= a) >= 0.5 and P(X >= a) >= 0.5
n <- 100
p <- 0.2
mu <- n * p
sd <- sqrt(n * p * (1 - p))

# a = 20
a <- 20
pbinom(a, n, p) # P(X <= a)
1 - pbinom(a - 1, n, p) # P(X >= a)

# for a = 19
# pbinom(19, n, p) # P(X <= 19)
# 1 - pbinom(18, n, p) # P(X >= 19)

# we have that a = 20 with P(X <= 20) = 0.5595 and P(X >= 20) = 0.5398 which are both >= 0.5
# therefore a = 20

print(a)

```


  


